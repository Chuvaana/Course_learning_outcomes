<div class="card">
  <p-accordion value="0">
    <p-accordion-panel value="1" *ngIf="hasLec">
      <p-accordion-header>Лекцийн агуулга</p-accordion-header>
      <p-accordion-content>
        <p-toast></p-toast>

        <p-button
          label="Хадгалах"
          class="submit-button"
          (click)="saveLecSchedule()"
        />

        <p-table
          *ngIf="!isLoading"
          [value]="lessonControls.controls"
          class="custom-table"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>7 хоног</th>
              <th>Лекцийн сэдэв</th>
              <th>Лекцийн цаг</th>
              <th>CLOs хамаарал</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-lesson>
            <tr [formGroup]="lesson">
              <td>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input pInputText formControlName="week" />
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("week").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input pInputText formControlName="title" type="text" />
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("title").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-inputNumber formControlName="time"></p-inputNumber>
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("time").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-dropdown
                      [options]="closLec"
                      formControlName="cloRelevance"
                      optionLabel="cloName"
                      optionValue="id"
                      appendTo="body"
                      placeholder="Сонгох"
                      [required]="true"
                    ></p-dropdown>
                  </ng-template>
                  <ng-template pTemplate="output">
                    <p-tag
                      [value]="getCloName(lesson.get('cloRelevance')?.value)"
                    ></p-tag>
                  </ng-template>
                </p-cellEditor>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-accordion-content>
    </p-accordion-panel>

    <p-accordion-panel value="2" *ngIf="hasSem">
      <p-accordion-header>Семинарын агуулга</p-accordion-header>
      <p-accordion-content>
        <p-toast></p-toast>
        <p-button
          label="Хадгалах"
          class="submit-button"
          (click)="saveSemSchedule()"
        />

        <p-table
          *ngIf="!isLoading"
          [value]="lessonSemControls.controls"
          class="custom-table"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>7 хоног</th>
              <th>Семинарын сэдэв</th>
              <th>Семинарын цаг</th>
              <th>CLOs хамаарал</th>
              <th>Оноо</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-lesson>
            <tr [formGroup]="lesson">
              <td>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input pInputText formControlName="week" />
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("week").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input pInputText formControlName="title" type="text" />
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("title").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-inputNumber formControlName="time"></p-inputNumber>
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("time").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-dropdown
                      [options]="closSem"
                      formControlName="cloRelevance"
                      optionLabel="cloName"
                      optionValue="id"
                      appendTo="body"
                      placeholder="Сонгох"
                      [required]="true"
                    ></p-dropdown>
                  </ng-template>
                  <ng-template pTemplate="output">
                    <p-tag
                      [value]="getCloName(lesson.get('cloRelevance')?.value)"
                    ></p-tag>
                  </ng-template>
                </p-cellEditor>
              </td>
              <!-- <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-inputNumber formControlName="point"></p-inputNumber>
                  </ng-template>
                  <ng-template pTemplate="output">
                    <ng-container
                      *ngIf="lesson.get('point')?.value > 0; else zeroPoint"
                    >
                      <p-tag [value]="lesson.get('point').value"></p-tag>
                    </ng-container>
                    <ng-template #zeroPoint>0</ng-template>
                  </ng-template>
                </p-cellEditor>
              </td> -->
              <td>
                <div
                  *ngFor="
                    let pCtrl of lesson.get('point')['controls'];
                    let i = index
                  "
                  [formGroup]="pCtrl"
                  class="point-row"
                >
                  <span
                    >{{ getSemMethodNameById(pCtrl.get("id").value) }}:</span
                  >
                  <p-inputNumber
                    formControlName="point"
                    [min]="0"
                  ></p-inputNumber>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-accordion-content>
    </p-accordion-panel>

    <p-accordion-panel value="3" *ngIf="hasLab">
      <p-accordion-header
        >Лаборатори/практикийн хичээлийн агуулга</p-accordion-header
      >
      <p-accordion-content>
        <p-toast></p-toast>
        <p-button
          label="Хадгалах"
          class="submit-button"
          (click)="saveLabSchedule()"
        />

        <p-table
          *ngIf="!isLoading"
          [value]="lessonLabControls.controls"
          class="custom-table"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>7 хоног</th>
              <th>Лаборатори/практикийн сэдэв</th>
              <th>Цаг</th>
              <th>CLOs хамаарал</th>
              <th>Оноо</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-lesson>
            <tr [formGroup]="lesson">
              <td>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input pInputText formControlName="week" />
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("week").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input pInputText formControlName="title" type="text" />
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("title").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-inputNumber formControlName="time"></p-inputNumber>
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("time").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-dropdown
                      [options]="closLab"
                      formControlName="cloRelevance"
                      optionLabel="cloName"
                      optionValue="id"
                      appendTo="body"
                      [required]="true"
                    ></p-dropdown>
                  </ng-template>
                  <ng-template pTemplate="output">
                    <p-tag
                      [value]="getCloName(lesson.get('cloRelevance')?.value)"
                    ></p-tag>
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <div
                  *ngFor="
                    let pCtrl of lesson.get('point')['controls'];
                    let i = index
                  "
                  [formGroup]="pCtrl"
                  class="point-row"
                >
                  <span>{{ getMethodNameById(pCtrl.get("id").value) }}:</span>
                  <p-inputNumber
                    formControlName="point"
                    [min]="0"
                  ></p-inputNumber>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-accordion-content>
    </p-accordion-panel>

    <p-accordion-panel value="4" *ngIf="hasBd">
      <p-accordion-header>Бие даан судлах агуулга</p-accordion-header>
      <p-accordion-content>
        <p-toast></p-toast>
        <p-button
          label="Хадгалах"
          class="submit-button"
          (click)="saveBdSchedule()"
        />

        <p-table
          *ngIf="!isLoading"
          [value]="lessonBdControls.controls"
          class="custom-table"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>7 хоног</th>
              <th>Бие даалтын сэдэв</th>
              <th>Танхимд зөвлөгөө авах, үнэлүүлэх цаг</th>
              <th>Бие даан суралцах цаг</th>
              <th>CLOs хамаарал</th>
              <th>Оноо</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-lesson>
            <tr [formGroup]="lesson">
              <td>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input pInputText formControlName="week" />
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("week").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <input pInputText formControlName="title" type="text" />
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("title").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-inputNumber formControlName="adviceTime"></p-inputNumber>
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("adviceTime").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-inputNumber formControlName="time"></p-inputNumber>
                  </ng-template>
                  <ng-template pTemplate="output">
                    {{ lesson.get("time").value }}
                  </ng-template>
                </p-cellEditor>
              </td>
              <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-dropdown
                      [options]="clos"
                      formControlName="cloRelevance"
                      optionLabel="cloName"
                      optionValue="id"
                      appendTo="body"
                      [required]="true"
                    ></p-dropdown>
                  </ng-template>
                  <ng-template pTemplate="output">
                    <p-tag
                      [value]="getCloName(lesson.get('cloRelevance')?.value)"
                    ></p-tag>
                  </ng-template>
                </p-cellEditor>
              </td>
              <!-- <td [pEditableColumn]>
                <p-cellEditor>
                  <ng-template pTemplate="input">
                    <p-inputNumber formControlName="point"></p-inputNumber>
                  </ng-template>
                  <ng-template pTemplate="output">
                    <ng-container
                      *ngIf="lesson.get('point')?.value > 0; else zeroPoint"
                    >
                      <p-tag [value]="lesson.get('point').value"></p-tag>
                    </ng-container>
                    <ng-template #zeroPoint>0</ng-template>
                  </ng-template>
                </p-cellEditor>
              </td> -->
              <td>
                <div
                  *ngFor="
                    let pCtrl of lesson.get('point')['controls'];
                    let i = index
                  "
                  [formGroup]="pCtrl"
                  class="point-row"
                >
                  <span>{{ getBdMethodNameById(pCtrl.get("id").value) }}:</span>
                  <p-inputNumber
                    formControlName="point"
                    [min]="0"
                  ></p-inputNumber>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-accordion-content>
    </p-accordion-panel>
  </p-accordion>
</div>
