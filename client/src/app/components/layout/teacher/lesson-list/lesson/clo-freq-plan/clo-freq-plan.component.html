<form [formGroup]="form">
  <p-toast></p-toast>

  <button pButton label="Хадгалах" (click)="saveData()" class="mt-3"></button>

  <p-accordion [multiple]="true" class="mt-4">
    <p-accordionTab
      *ngFor="let type of objectKeys(groupedDataSource)"
      [header]="'Төрөл: ' + getTypeName(type)"
    >
      <p-table
        [value]="groupedDataSource[type]"
        [tableStyle]="{ width: '100%' }"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Давтамж /7 хоног/</th>
            <th>CLO</th>
            <th>Дэд арга</th>
            <th>Оноо</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
          <tr
            *ngFor="let subRow of rowData.score; let subIndex = index"
            [formGroup]="rowData.formGroup"
          >
            <td
              *ngIf="subIndex === 0 && rowData.isFirstWeek"
              [attr.rowspan]="rowData.score.length"
            >
              <p-dropdown
                [options]="weekOptions"
                formControlName="week"
                (onChange)="onWeekChange(rowData.formGroup)"
                [showClear]="true"
                placeholder="Долоо хоног сонгох"
              ></p-dropdown>
            </td>

            <td
              *ngIf="subIndex === 0 && rowData.isFirstClo"
              [attr.rowspan]="rowData.score.length"
            >
              {{ subRow.cloName }}
            </td>

            <td>{{ subRow.methodName }}</td>

            <td>
              <p-inputNumber
                [formControlName]="'score' + subIndex"
                [showButtons]="true"
                [step]="1"
                [min]="0"
              ></p-inputNumber>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-accordionTab>
  </p-accordion>
</form>
